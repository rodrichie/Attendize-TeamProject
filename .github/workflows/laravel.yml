name: Attendize

on:
  pull_request:
    types: [assigned, edited, opened, synchronize, reopened]
  push:
    branches:
      - main
      - Rodrick
      - Laura
      - Lynn
      - Stephen
      - v2*

jobs:
  laravel-build-and-test-ubuntu:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: Set up PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: 7.4
        extensions: mbstring, intl, dom, pdo_mysql
        ini-values: post_max_size=256M, upload_max_filesize=256M, memory_limit=512M
        coverage: xdebug

    - name: Install Dependencies
      run: composer install --prefer-dist --no-progress --no-suggest

    - name: Create Database
      run: |
        mkdir -p database
        touch database/database.sqlite

    - name: Set environment variables
      run: |
        echo "APP_ENV=testing" >> .env
        echo "APP_KEY=base64:KD2IT+rBXDNXTe4ao5aF4/2SELqS6xfnc/lvB0caxvI=" >> .env
        echo "DB_CONNECTION=sqlite" >> .env
        echo "DB_DATABASE=database/database.sqlite" >> .env

    - name: Run Migrations
      run: php artisan migrate --force

    - name: Execute tests (Unit and Feature tests) via PHPUnit
      run: vendor/bin/phpunit

    - name: Install PHP_CodeSniffer
      run: composer require --dev squizlabs/php_codesniffer

    - name: Run PHP_CodeBeautifier (phpcbf)
      run: vendor/bin/phpcbf --standard=PSR12 app/ tests/

    - name: Run PHP_CodeSniffer (phpcs)
      run: vendor/bin/phpcs --standard=PSR12 app/ tests/